# 月極駐車場契約・決済アプリ 開発プロンプト（with Best Practices）

## 技術スタック

- **Frontend**: React + TypeScript + Vite + Tailwind CSS
- **Backend / Hosting / DB**: Supabase
- **Payments**: Stripe Checkout
- **Version Control**: Git + GitHub

---

## アプリ概要

オーナーが一人で管理できる「月極駐車場の契約・支払い管理アプリ」。契約者は名前のみでアクセスし、クレジットカード（Stripe）で月額料金を支払う。オーナーは契約者の未払いをダッシュボードで確認できる。認証はシンプルに保ち、UXに配慮したミニマル構成。

---

## 機能要件

### 契約者

- 名前のみで専用ページにアクセス（ログイン不要）
- 支払い対象の月を確認し、支払い月数を選択して決済
- 支払い完了後に「完了画面」表示
- 支払い履歴を閲覧可能（各月単位で PDF 領収書ダウンロード対応）

### オーナー

- ダッシュボードで契約者ごとの支払い状況を一覧確認
- 契約者の詳細ページで支払履歴を表示
- オーナーは自身で支払いは行わない

---

## 支払い仕様

- 支払い単位: 月額（3,500円） ※将来的に変更可能にしておく
- 支払いは月数選択で、金額が自動計算
- 割引・手数料・日割り契約は非対応
- Stripe登録不要（Checkoutで完結）

---

## GitHub活用方針（ソース管理）

- GitHub上でプロジェクトを管理し、以下の点を徹底する:

### ブランチ戦略（例: GitHub Flow）

- `main`: 本番用安定ブランチ
- `dev`: 開発統合ブランチ
- `feature/*`: 機能追加用（例: `feature/payment`）
- `fix/*`: バグ修正用
- Pull Request (PR) ベースでマージ（レビュー必須）

### CI/CD（今後導入予定）

- GitHub Actions を使って自動テスト / Lint / Build の検証を実装可能にする前提で設計
- Supabase へのデプロイは CLI or GitHub連携で将来対応できるように

---

## ビッグテック的ベストプラクティス（反映済）

- **型安全**: TypeScriptの徹底活用で型安全を担保
- **ルール化された開発プロセス**: GitHub Flow + PRベースで進行
- **オートメーション**: Lint / Format / Testの自動化（CI想定）
- **再利用性の高いUIコンポーネント**: Atomic Designを意識
- **エラー処理とログ設計**: StripeやSupabaseのエラーに備えたトーストUI or ログ設計
- **セキュリティ最小化原則**: ユーザー認証は最小構成（名前のみ）で漏洩リスク低減
- **拡張性のある設計**: 月額変更・領収書発行の拡張を意識
- **ドキュメント文化**: README, API仕様, スキーマ設計書なども随時更新

---

## ルーティング構成

```

/owner
└─ オーナーダッシュボード（契約者一覧、未払い表示）

/owner/contractor/\:id
└─ 契約者詳細（支払履歴表示のみ）

/contractor/\:name
└─ 契約者ページ（未払い表示 + 支払い + PDF履歴）

```

---

## DBスキーマ（初期設計）

### contractors（契約者）

| カラム名       | 型         | 説明                      |
|----------------|------------|---------------------------|
| id             | UUID       | 主キー                    |
| name           | text       | 契約者名（ユニーク）      |
| parking_number | text       | 駐車スペース番号          |
| created_at     | timestamp  | 登録日                    |

---

### payments（支払い履歴）

| カラム名                  | 型       | 説明                            |
|---------------------------|----------|---------------------------------|
| id                        | UUID     | 主キー                          |
| contractor_id             | UUID     | 外部キー                        |
| year                      | int      | 支払年                          |
| month                     | int      | 支払月                          |
| amount                    | int      | 金額（円）                      |
| paid_at                   | timestamp| 支払日時                        |
| stripe_payment_intent_id  | text     | Stripe支払ID                    |

---

## その他要件

- **支払い後に「完了画面」表示**
- **各支払いに対する PDF 領収書出力機能**
- **月額は将来変更可能（環境変数 or Supabase側の管理テーブル）**
- **Stripe Checkout セッションで動的に金額設定**
- **名前による簡易アクセスのみで、ログイン不要**
- **PDF発行は支払い履歴ページ内に設置**
